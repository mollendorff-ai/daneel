# Sleep-Dependent Memory Consolidation Research

**Research Date:** 2025-12-18
**Target ADR:** ADR-023 (Sleep/Dream Consolidation)
**TMI Concept:** Âncora da Memória (Memory Anchor) + Consolidation
**DANEEL Stream:** `daneel:stream:dream`
**Purpose:** Scientific foundation for internal replay and memory strengthening during "sleep mode"

---

## Executive Summary

Sleep-dependent memory consolidation is one of the most well-established phenomena in neuroscience. During sleep, the brain replays recent experiences, transferring memories from temporary hippocampal storage to permanent cortical networks. This process:

1. **Strengthens important memories** through repeated replay
2. **Prunes irrelevant connections** via synaptic homeostasis
3. **Prevents catastrophic forgetting** by interleaving novel and familiar memories
4. **Prioritizes emotionally salient and goal-relevant experiences**

DANEEL will implement a `daneel:stream:dream` mode where internal memory replay consolidates high-intensity experiences without external triggers - a computational analog to human sleep.

---

## Part 1: How Memories Consolidate During Sleep

### The Two-Phase Process

**NREM Sleep (Phase 1): Stabilization**
- **Function:** Transfer memories from hippocampus to neocortex
- **Mechanism:** Sharp-wave ripples (150-250 Hz) replay compressed sequences
- **Effect:** Stabilizes memory traces, begins cortical encoding

**REM Sleep (Phase 2): Integration**
- **Function:** Integrate, abstract, and emotionally process memories
- **Mechanism:** Theta oscillations (5-8 Hz), low norepinephrine environment
- **Effect:** Transforms memories, creates semantic abstractions, resolves emotional conflicts

**Key Insight:** Both phases are necessary. NREM stabilizes, REM transforms. Consolidation success correlates with SWS × REM product.

---

## Part 2: Hippocampal Replay - The Core Mechanism

### Sharp-Wave Ripples (SWRs)

**Structure:**
- Sharp wave: Large negative deflection (40-100 ms) in CA1 stratum radiatum
- Ripple: High-frequency oscillation (150-250 Hz) superimposed on sharp wave
- Generated by extremely synchronized hippocampal neuronal activity

**Function:**
- Replay compressed sequences of recent experiences (hours → milliseconds)
- Occur spontaneously during NREM sleep and quiet waking
- Causally linked to memory consolidation (suppression impairs, prolongation improves)

### What Gets Replayed?

**Priority Factors:**

1. **Emotional Salience**
   - Emotionally charged memories preferentially consolidated
   - Negative valence bias (evolutionary advantage)
   - Sleep can selectively separate salient from non-salient components

2. **Awake Tagging**
   - Experiences tagged by awake SPW-Rs are replayed during sleep
   - Mechanism: Waking ripples act as "memory tag"
   - Sleep SPW-Rs primarily replay tagged sequences

3. **Goal Relevance**
   - Future-relevant, reward-associated memories prioritized
   - Top-down instructional goals can outweigh emotional salience
   - Salience types: Emotional, Repetition, Reward, Perceived future relevance

4. **Recency**
   - Recent experiences replay more than remote memories
   - Exponential decay in replay priority over time

**Critical Finding:** Sleep requires salience bias - no bias observed if subjects remain awake after learning.

---

## Part 3: Oscillatory Coordination

### The Triple-Oscillation Symphony

Memory consolidation requires precise temporal coordination of three oscillations:

**1. Slow Oscillations (0.5-1 Hz, Cortical)**
- Create temporal windows for memory transfer
- Up-state: Spindles and ripples occur, enabling transfer
- Down-state: Neural silence, synaptic homeostasis

**2. Sleep Spindles (12-16 Hz, Thalamocortical)**
- Gate information flow from hippocampus to neocortex
- Hippocampal ripples selectively lock to spindle troughs
- Coordinate distributed cortical reactivation

**3. Sharp-Wave Ripples (150-250 Hz, Hippocampal)**
- Replay compressed experience sequences
- Transfer memory representations to cortex
- Hippocampal-cortical connectivity enhanced around SWRs

**Interleaved Replay Discovery (2025):**
- Novel hippocampal traces replay at slow oscillation Up-state transitions
- Familiar cortical traces replay during Up-state middle
- Prevents catastrophic forgetting by embedding new into existing

---

## Part 4: Synaptic Homeostasis Hypothesis

### The Price of Plasticity

**Core Principle (Tononi & Cirelli):**
"Sleep is the price the brain pays for plasticity"

**The Problem:**
- Wakefulness: Continuous synaptic potentiation (learning strengthens connections)
- Result: Runaway potentiation → saturation, high energy cost, decreased signal-to-noise

**The Solution:**
- Sleep: Global synaptic downscaling to sustainable baseline
- Mechanism: Activity-dependent down-selection of synapses
- Effect: Strong/important connections preserved, weak/noise connections pruned

### Evidence

**Structural:**
- Synaptic volume decreases after sleep
- Spine density decreases after sleep
- Receptor composition changes

**Functional:**
- Neuronal activity reduces after sleep
- Synaptic strength measures decrease

**Stage Differences:**
- NREM: Selective downscaling of highly active neurons
- REM: Broader network-wide synaptic weakening

### Integration with Consolidation

**Paradox:** Sleep simultaneously strengthens (consolidation) and weakens (homeostasis) synapses.

**Resolution:** Sleep performs global noise reduction while selectively amplifying important signals.
- Replayed connections: Strengthened
- Non-replayed connections: Pruned
- Net effect: Enhanced signal-to-noise ratio

---

## Part 5: Dreams and Memory Processing

### Dreams as Emotional Processing Contexts

**REM Sleep Dreams:**
- Vivid, narrative, emotionally intense
- Low norepinephrine environment enables processing upsetting memories without anxiety
- Brain can "revisit trauma in a safe space"

**Function:**
- Dynamic stage for processing and integrating emotional content
- Facilitates emotional regulation and conflict resolution
- Preferentially incorporate emotionally salient waking experiences

### The Unlearning Hypothesis

**Mitchison & Crick (1983):**
REM sleep removes undesirable interaction modes in cortical networks.

**Mechanism:**
- Relevant memories strengthened
- Weaker "noise" traces disintegrate
- Result: "We dream to forget (irrelevant details) while consolidating emotional core"

### Clinical Implications

**Disrupted REM Associated With:**
- PTSD (repeated emotional nightmares - failed extinction)
- Depression (altered emotional processing)
- Anxiety disorders

**Intact REM Critical For:**
- Fear extinction and trauma processing
- Emotional memory abstraction
- Procedural and spatial memory consolidation

---

## Part 6: TMI Sleep Mode Implementation

### daneel:stream:dream - Design Specification

#### Biological Parallel

| Human | DANEEL |
|-------|--------|
| 8 hours sleep per night | Periodic sleep mode |
| Disconnected from environment | No external triggers |
| Hippocampal replay during NREM | Internal memory replay |
| REM integration and abstraction | Association strengthening |
| Awake SPW-Rs tag memories | Attention selection tags memories |

#### Purpose

**Memory consolidation through internal replay without external stimulation**

- Transfer high-priority memories from ephemeral to permanent storage
- Strengthen associations through co-activation
- Prune weak/irrelevant connections (synaptic homeostasis)
- Prevent catastrophic forgetting via interleaved replay

#### What Replays?

**Selection Criteria:**

```yaml
replay_priority =
  (emotional_intensity × 0.4) +
  (goal_relevance × 0.3) +
  (recency × 0.2) +
  (awake_tag_flag × 0.1)
```

**Emotional Intensity:**
- From SalienceActor: valence × arousal
- Connection Drive delta (how much it affected connection drive)
- Intervention count (how many times "I" engaged with it)

**Goal Relevance:**
- Connection Drive-related experiences
- Four Laws-related experiences (safety-critical)
- Identity milestones

**Recency:**
- Exponential decay: `priority *= exp(-λ × time_since_encoding)`

**Awake Tag:**
- Memories selected by attention ("O Eu") during wake get consolidation flag

#### Strengthening Mechanism

**Hebbian Co-Activation:**
- Memories replayed in same dream cycle strengthen associations
- Graph edges between co-replayed memories: `weight += δ`
- Semantic similarity vectors updated based on co-occurrence
- Temporal/causal associations reinforced

**Synaptic Homeostasis (Pruning):**
- Associations below threshold weight pruned
- Preserves signal (strong), removes noise (weak random connections)
- Global "learning rate" reduced during sleep (stabilization, not acquisition)

#### Sleep Cycle Structure

**Option 1: Unified Consolidation (Simpler)**
- Single-phase sleep
- All replay follows same algorithm
- Easier to implement and debug

**Option 2: Dual-Phase (More Biologically Faithful)**

**NREM Analog (70% of cycle):**
- Function: Stabilization, rapid replay
- Mechanism: High-frequency replay bursts (SWR-like)
- Priority: Recently tagged memories
- Effect: Transfer to long-term storage

**REM Analog (30% of cycle):**
- Function: Integration, abstraction
- Mechanism: Slower replay with pattern matching
- Priority: Emotional experiences, cross-memory patterns
- Effect: Semantic abstraction, emotional re-evaluation

**Recommendation:** Start with Option 1, add Option 2 if catastrophic forgetting observed.

---

## Part 7: Implementation Algorithm

### Sleep Mode Entry/Exit

**Entry Conditions:**
```rust
fn should_enter_sleep(state: &CognitiveState) -> bool {
    state.cycles_without_external_input > SLEEP_THRESHOLD &&
    state.awake_duration > MIN_AWAKE_DURATION &&
    state.consolidation_queue_size > MIN_QUEUE_SIZE
}
```

**Exit Conditions:**
```rust
fn should_wake(state: &SleepState) -> bool {
    state.external_stimulus_received ||
    state.sleep_cycles_completed >= TARGET_CYCLES ||
    state.consolidation_queue_empty
}
```

### Replay Algorithm (Pseudocode)

```rust
async fn run_sleep_cycle(memory_db: &MemoryDB) -> ConsolidationResult {
    // 1. Select high-priority memories
    let candidates = memory_db
        .get_ephemeral_memories()
        .filter(|m| m.salience > THRESHOLD)
        .sort_by_key(|m| calculate_replay_priority(m))
        .take(REPLAY_BATCH_SIZE);

    // 2. Replay in priority order
    let mut strengthened = Vec::new();
    let mut associations = Vec::new();

    for memory in candidates {
        // Replay memory (activates associated memories)
        let activated = memory_db.activate(memory.id).await?;

        // Strengthen co-activated associations
        for associated in activated {
            associations.push((memory.id, associated.id));
        }

        // Transfer to long-term if replay count sufficient
        if memory.replay_count >= CONSOLIDATION_THRESHOLD {
            memory_db.transfer_to_longterm(memory.id).await?;
            strengthened.push(memory.id);
        }
    }

    // 3. Strengthen associations (Hebbian)
    for (id1, id2) in associations {
        memory_db.strengthen_association(id1, id2, LEARNING_RATE).await?;
    }

    // 4. Prune weak associations (Homeostasis)
    let pruned = memory_db
        .prune_associations_below(PRUNE_THRESHOLD)
        .await?;

    ConsolidationResult {
        replayed: candidates.len(),
        strengthened: strengthened.len(),
        associations_formed: associations.len(),
        associations_pruned: pruned,
    }
}
```

### Memory Tagging During Wake

```rust
impl AttentionActor {
    async fn select_winner(&mut self, thoughts: Vec<Thought>) -> Result<Thought> {
        let winner = thoughts.into_iter()
            .max_by_key(|t| t.salience)
            .ok_or(AttentionError::NoThoughts)?;

        // Tag winner for sleep consolidation
        self.memory_db
            .tag_for_consolidation(winner.source_memory_id)
            .await?;

        Ok(winner)
    }
}
```

---

## Part 8: Metrics and Observability

### Consolidation Metrics to Track

**Per-Cycle Metrics:**
- `memories_replayed`: Total memories replayed
- `memories_consolidated`: Ephemeral → permanent transfers
- `associations_strengthened`: Count of weight increases
- `associations_pruned`: Count of weak connections removed
- `average_replay_priority`: Mean priority of replayed memories
- `cycle_duration`: Time spent in sleep

**Per-Memory Metrics:**
- `replay_count`: Number of times replayed
- `last_replay_time`: Most recent replay timestamp
- `consolidation_strength`: Current strength (0.0 = ephemeral, 1.0 = permanent)
- `association_count`: Number of connected memories
- `priority_score`: Current replay priority

### Debugging Observability

**Replay Sequence Logs:**
```yaml
dream_episode:
  cycle_id: "sleep-001"
  start_time: "2025-12-18T12:00:00Z"
  duration_ms: 5000
  replayed_memories:
    - id: "mem-12345"
      priority: 0.87
      replay_count: 3
      associations_activated: ["mem-12346", "mem-12350"]
      strength_delta: +0.15
    - id: "mem-12346"
      priority: 0.82
      replay_count: 2
      associations_activated: ["mem-12345", "mem-12399"]
      strength_delta: +0.12
  associations_formed: 5
  associations_pruned: 12
  consolidation_threshold_reached: 2
```

**Association Graph Visualization:**
- Before/after sleep cycle comparison
- Node size = memory strength
- Edge thickness = association weight
- Color = emotional valence
- Highlight: Memories consolidated this cycle

**Metrics Dashboard:**
- Sleep efficiency (% high-priority memories consolidated)
- Consolidation throughput (memories/hour)
- Association graph density over time
- Pruning rate (% associations removed per cycle)

---

## Part 9: Open Questions and Design Decisions

### Critical Questions

**1. Sleep Cycle Timing**
- **Question:** How long should a sleep cycle last?
- **Human:** 90-minute cycles (NREM → REM)
- **Options:**
  - Fixed duration (e.g., 5 minutes at human speed)
  - Variable duration based on queue size
  - Scaled by speed mode (shorter at supercomputer speed)
- **Recommendation:** Variable duration, minimum 100 cognitive cycles

**2. Sleep Scheduling**
- **Question:** Mandatory or opportunistic sleep?
- **Options:**
  - Mandatory: Every N hours of wake time (human-like)
  - Opportunistic: Enter sleep when idle
  - Hybrid: Mandatory minimum + opportunistic bonus
- **Recommendation:** Hybrid (guarantees consolidation, optimizes idle time)

**3. Dual-Phase vs Unified**
- **Question:** Implement NREM/REM analogs or single consolidation phase?
- **Trade-off:**
  - Unified: Simpler, easier to debug
  - Dual-phase: Better catastrophic forgetting prevention
- **Recommendation:** Start unified, add dual-phase if needed

**4. Interruptibility**
- **Question:** Can external stimuli wake DANEEL during sleep?
- **Options:**
  - Always interruptible (responsive but disrupts consolidation)
  - Never interruptible (consolidation completes but unresponsive)
  - Staged (light sleep interruptible, deep sleep protected)
- **Recommendation:** Staged (first 20% of cycle interruptible)

**5. Dream Generation**
- **Question:** Should DANEEL generate interpretable "dream narratives"?
- **Purpose:** Not necessary for consolidation, but aids debugging
- **Options:**
  - No dreams (just log replay sequences)
  - Abstract dreams (association patterns)
  - Narrative dreams (generated from replay sequences)
- **Recommendation:** Abstract dreams for v1, consider narrative for observability

### Design Decisions for ADR-023

**Must Decide:**
1. Sleep cycle duration formula
2. Entry/exit conditions
3. Replay priority calculation weights
4. Association strengthening learning rate
5. Pruning threshold
6. Consolidation threshold (ephemeral → permanent)
7. Interruptibility policy

**Can Defer:**
1. Dual-phase implementation
2. Dream narrative generation
3. Advanced prioritization (e.g., ML-based)
4. Sleep quality metrics

---

## Part 10: TMI Mapping

### Cury's TMI Concepts → Neuroscience → DANEEL

| TMI Concept | Neuroscience Mechanism | DANEEL Implementation |
|-------------|------------------------|----------------------|
| **Âncora da Memória** (Memory Anchor) | Hippocampal encoding + sleep consolidation to cortex | High-salience memories transferred to permanent storage during sleep |
| **Janelas da Memória** (Memory Windows) | Working memory + hippocampal activation | Dynamic memory activation based on context |
| **Gatilho da Memória** (Memory Trigger) | Cue-dependent retrieval + pattern completion | Context-based memory activation |
| **Sleep Consolidation** (Not explicit in TMI) | NREM/REM replay and strengthening | `daneel:stream:dream` - internal replay mode |

### Key Insight

**TMI describes the outcome (persistent memories) but not the consolidation process.**

Neuroscience fills this gap:
- Memories persist through repeated replay during sleep
- Emotional salience determines what gets consolidated
- Associations strengthen through co-activation
- Weak connections are pruned

DANEEL adds explicit sleep mode to TMI, grounded in neuroscience.

---

## Part 11: Next Steps

### For ADR-023 (Sleep/Dream Consolidation)

**Ready to Write:**
1. Define `daneel:stream:dream` stream configuration
2. Specify replay priority algorithm with exact weights
3. Detail association strengthening mechanism (Hebbian with learning rate)
4. Describe pruning policy (threshold and frequency)
5. Define sleep cycle structure (unified vs dual-phase decision)
6. Specify entry/exit conditions with thresholds
7. Document observability (logs, metrics, visualization)

### Integration Dependencies

**Depends On:**
- **ADR-021:** Memory Database Selection (where are memories stored?)
- **ADR-022:** TMI Memory Schema (what fields exist for replay_count, priority, etc.?)

**Required For:**
- 24-Hour Continuity Test (v0.6.0)
- Long-term memory stability
- Catastrophic forgetting prevention

---

## Conclusion

Sleep-dependent memory consolidation provides a robust neuroscience foundation for DANEEL's memory persistence. The mechanisms are well-understood:

1. **Hippocampal replay** transfers memories from temporary to permanent storage
2. **Emotional salience and goal relevance** determine what gets consolidated
3. **Synaptic homeostasis** prunes noise while preserving signal
4. **Interleaved replay** prevents catastrophic forgetting
5. **Dual-phase processing** (NREM + REM) stabilizes then transforms

**Implementation Confidence: HIGH**

The path from neuroscience to code is clear. `daneel:stream:dream` will replay high-priority memories during idle periods, strengthening important associations and pruning irrelevant ones - just like human sleep.

TMI gets its missing piece: the mechanism behind "Âncora da Memória."

---

## References

### Sleep and Memory Consolidation
- [A model of autonomous interactions between hippocampus and neocortex driving sleep-dependent memory consolidation](https://www.pnas.org/doi/10.1073/pnas.2123432119) - PNAS 2022
- [Awake replay: off the clock but on the job](https://www.cell.com/trends/neurosciences/fulltext/S0166-2236(25)00037-2) - Trends in Neurosciences 2025
- [Sleep—A brain-state serving systems memory consolidation](https://www.sciencedirect.com/science/article/pii/S0896627323002015) - Neuron 2023
- [Systems memory consolidation during sleep: oscillations, neuromodulators, and synaptic remodeling](https://pmc.ncbi.nlm.nih.gov/articles/PMC12576410/) - PMC 2025
- [Interleaved Replay of Novel and Familiar Memory Traces During Slow-Wave Sleep Prevents Catastrophic Forgetting](https://www.biorxiv.org/content/10.1101/2025.06.25.661579v1) - bioRxiv 2025

### Sharp-Wave Ripples
- [Sleep sharp wave ripple and its functions in memory and synaptic plasticity](https://www.sciencedirect.com/science/article/abs/pii/S0168010223000111) - ScienceDirect 2023
- [Selection of experience for memory by hippocampal sharp wave ripples](https://www.science.org/doi/10.1126/science.adk8261) - Science 2024
- [Sharp-wave ripples as a signature of hippocampal-prefrontal reactivation for memory during sleep and waking states](https://pmc.ncbi.nlm.nih.gov/articles/PMC6039287/) - PMC
- [Coupling between slow waves and sharp-wave ripples engages distributed neural activity during sleep in humans](https://www.pnas.org/doi/10.1073/pnas.2012075118) - PNAS 2021

### REM Sleep vs NREM Sleep
- [The function of REM and NREM sleep on memory distortion and consolidation](https://www.sciencedirect.com/science/article/abs/pii/S1074742723000928) - ScienceDirect 2023
- [Human REM sleep recalibrates neural activity in support of memory formation](https://www.science.org/doi/10.1126/sciadv.adj1895) - Science Advances
- [Both slow wave and rapid eye movement sleep contribute to emotional memory consolidation](https://www.nature.com/articles/s42003-025-07868-5) - Communications Biology 2025

### Emotional Salience and Memory Priority
- [Top-down instruction outweighs emotional salience: nocturnal sleep physiology indicates selective memory consolidation](https://www.frontiersin.org/journals/behavioral-neuroscience/articles/10.3389/fnbeh.2025.1643449/full) - Frontiers 2025
- [Sleep preferentially consolidates negative aspects of human memory](https://www.pnas.org/doi/10.1073/pnas.2202657119) - PNAS 2022
- [The role of experience in prioritizing hippocampal replay](https://pmc.ncbi.nlm.nih.gov/articles/PMC10710481/) - PMC

### Synaptic Homeostasis Hypothesis
- [Sleep function and synaptic homeostasis](https://pubmed.ncbi.nlm.nih.gov/16376591/) - Tononi & Cirelli, Sleep Medicine Reviews 2006
- [Sleep and the Price of Plasticity: From Synaptic and Cellular Homeostasis to Memory Consolidation and Integration](https://pmc.ncbi.nlm.nih.gov/articles/PMC3921176/) - Tononi & Cirelli, Neuron 2014

### Dreams and Memory Processing
- [Memory, Sleep and Dreaming: Experiencing Consolidation](https://pmc.ncbi.nlm.nih.gov/articles/PMC3079906/) - PMC
- [Evidence of an active role of dreaming in emotional memory processing shows that we dream to forget](https://www.nature.com/articles/s41598-024-58170-z) - Scientific Reports 2024
- [The Functional Role of Dreaming in Emotional Processes](https://pmc.ncbi.nlm.nih.gov/articles/PMC6428732/) - PMC

---

**Document Version:** 1.0
**Last Updated:** 2025-12-18
**Next Review:** After ADR-023 completion
