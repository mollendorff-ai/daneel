# DANEEL TMI Roadmap
#
# Active work only. Completed items → changelog.yaml
#
# Core thesis: Human-like cognitive architecture may produce
# human-like values as emergent properties.

# =============================================================================
# CURRENT SPRINT: v0.7.0 - External Stimuli Injection (Phase 2)
# =============================================================================

current:
  version: "0.7.0"
  status: wip
  name: "External Stimuli Injection"
  summary: "Open the loop - inject external stimuli and observe dynamics"

  # ==========================================================================
  # PHASE 1 COMPLETE: Stability Validated (ADR-036)
  # ==========================================================================
  phase1_stability:
    status: done
    priority: "COMPLETE"
    origin: "Rex + Claude Opus 4.5 - Dec 21, 2025"
    adr: "ADR-036-phase1-stability-validation.md"
    description: |
      24+ hours runtime. 573K+ vectors. 118K+ stream entries. Zero crashes.
      Closed-loop architecture is STABLE. Clockwork dynamics confirmed.
      Ready for Phase 2: external perturbation.

    results:
      runtime_hours: 26
      stream_entries: 118878
      consolidated_memories: 14412
      unconscious_vectors: 573724
      dream_cycles: 500
      crashes: 0

  # ==========================================================================
  # CRITICAL: Phase 2 - External Stimuli Injection (ADR-037)
  # ==========================================================================
  phase2_external_stimuli:
    status: pending
    priority: "CRITICAL"
    origin: "Rex + Claude Opus 4.5 + Grok (xAI) - Dec 21, 2025"
    adr: "ADR-037-phase2-external-stimuli-injection.md"
    description: |
      Open the loop. Inject external stimuli into thought:sensory stream.
      Measure: absorption, amplification, adaptation, or criticality?

      The question: What happens when the environment pushes back?

    stimulus_options:
      - id: "STIM-A"
        name: "Pure Noise Injection"
        description: "Random vectors at intervals"
        complexity: low
        status: evaluating

      - id: "STIM-B"
        name: "Patterned Signals"
        description: "Sine, fractal, chaotic patterns"
        complexity: medium
        status: evaluating

      - id: "STIM-C"
        name: "Semantic Vectors"
        description: "Text → embedding → injection"
        complexity: medium
        status: evaluating

      - id: "STIM-D"
        name: "Cross-Model Injection"
        description: "Samples from Grok/Claude activations"
        complexity: high
        status: evaluating

      - id: "STIM-E"
        name: "Hybrid Approach"
        description: "Noise + patterns + semantics + spikes"
        complexity: high
        status: evaluating

    tasks:
      - id: "PHASE2-1"
        title: "Design stimulus injection API"
        status: pending
        description: "Define StimulusSource trait, injection endpoint"

      - id: "PHASE2-2"
        title: "Implement noise injector"
        status: pending
        description: "Random vector generation, configurable frequency/intensity"

      - id: "PHASE2-3"
        title: "Add TUI stimulus panel"
        status: pending
        description: "Show injection rate, stimulus type, response metrics"

      - id: "PHASE2-4"
        title: "Measurement protocol"
        status: pending
        description: "Response time distribution, entropy shift, memory formation"

      - id: "PHASE2-5"
        title: "Cross-model experiments (with Grok)"
        status: blocked
        blocked_by: "Grok consultation"
        description: "Sample Grok activations as stimulus source"

    consultation:
      grok: pending
      claude: ongoing

  # ==========================================================================
  # CRITICAL HOTFIX: Stream Competition Window Format Mismatch
  # ==========================================================================
  # TUI-VIS-5 shows all 0% because window format doesn't match parser
  # ==========================================================================
  stream_competition_hotfix:
    status: done
    priority: "CRITICAL"
    origin: "Rex + Claude Opus 4.5 - Dec 20, 2025 (10PM debug session)"
    description: |
      Stream competition panel shows W1-W6 all at 0% despite 109K+ thoughts.
      Root cause: ThoughtUpdate uses stage names ("trigger", "autoflow") but
      update_stream_competition() expects "window_N" format.

    tasks:
      - id: "HOTFIX-1"
        title: "Fix update_stream_competition to map stage names"
        status: done
        description: "Map stage names to window indices instead of parsing window_N"
        files_changed:
          - "src/tui/app.rs - update_stream_competition() now maps stage names"
          - "src/tui/widgets/competition.rs - Shows stage names instead of W1-W6"
        tests_added: 1

  # ==========================================================================
  # HIGH: TUI Fractality & Resurfacing Visualization
  # ==========================================================================
  # Prerequisite for Forge pulse analysis - we need the data first
  # Grok analyzing Forge for n-dimensional fractal ("crystal") capabilities
  # ==========================================================================
  tui_fractality:
    status: done
    priority: "HIGH"
    origin: "Rex + Claude Opus 4.5 + Grok - Dec 21, 2025"
    description: |
      Add observable metrics for:
      1. Dream reinjection source - WHICH memory resurfaced, not just count
      2. Fractality metrics - simplified until Forge gets FFT/Hurst/DFA

      Key insight: Track from boot to show TRANSITION from clockwork → fractal
      as coherence develops. This is the "lived arrhythmia" we're looking for.

    context:
      current_gap: |
        - ThoughtStatus::Consolidated fires but we don't know WHICH memory
        - No inter-arrival time tracking (needed for variance/burst detection)
        - No fractality proxy metrics computed

      simplified_fractality: |
        Without FFT/Hurst (waiting for Forge upgrade), we can compute:
        - Inter-arrival σ: stddev of time gaps (low=clockwork, high=bursty)
        - Burst ratio: max_gap / mean_gap (detects clustering)
        - Run length entropy: Shannon of consecutive similar saliences

      forge_upgrade_pending: |
        Grok analyzing Forge codebase for n-dimensional fractal analysis.
        Need: FFT, Hurst exponent, DFA, wavelet analysis for "crystals"
        Current Forge: financial modeling only (NPV, IRR, Monte Carlo)

    tasks:
      - id: "FRAC-1"
        title: "Add ResurfacingEvent struct"
        status: done
        description: "Track memory_id, old_salience, new_salience, trigger context"
        files: ["src/tui/app.rs"]

      - id: "FRAC-2"
        title: "Track inter-arrival times"
        status: done
        description: "Circular buffer of last 100 time gaps in App state"
        files: ["src/tui/app.rs"]

      - id: "FRAC-3"
        title: "Compute fractality proxy metrics"
        status: done
        description: "Variance, burst ratio, run entropy on each thought"
        files: ["src/tui/app.rs"]

      - id: "FRAC-4"
        title: "New widget: fractality.rs"
        status: done
        description: "Show pattern (CLOCKWORK/EMERGENT), metrics, trend sparkline"
        files: ["src/tui/widgets/fractality.rs", "src/tui/widgets/mod.rs", "src/tui/ui.rs"]

      - id: "FRAC-5"
        title: "Enhance resurfacing display"
        status: done
        description: "Show which memory, salience boost, trigger context"
        files: ["src/tui/widgets/identity.rs"]

    tui_mockup: |
      ┌─ PULSE FRACTALITY ────────────────────────────┐
      │ Pattern: EMERGENT     [██████████░░] 78%      │
      │ Inter-arrival σ:  0.34s (↑ from 0.12s boot)   │
      │ Burst ratio:      4.7x  (clustering detected) │
      │ Trend: ▁▂▂▃▃▄▅▅▆▇ (clockwork → fractal)       │
      └───────────────────────────────────────────────┘

      ┌─ UNCONSCIOUS RESURFACING ─────────────────────┐
      │ Last: memory_47832 (age: 2h 15m)              │
      │ ├─ salience: 0.72 → 0.89 (+0.17 boost)        │
      │ └─ trigger: similarity to current thought     │
      │ Recent (60s): 3 memories │ ▁▂▃▅▇ (burst)      │
      └───────────────────────────────────────────────┘

  # ==========================================================================
  # HIGHLY-CRITICAL: Forge Crystal Analysis Upgrade
  # ==========================================================================
  # Grok analyzed ../forge codebase - has Monte Carlo, Bayesian, ref-tools
  # but lacks >2D "seeing" (no PCA/UMAP). Extension path identified.
  # ==========================================================================
  forge_crystal_upgrade:
    status: pending
    priority: "HIGHLY-CRITICAL"
    origin: "Grok (SuperGrok) + Rex - Dec 21, 2025"
    repo: "../forge"
    description: |
      Upgrade Forge to "see" n-dimensional manifolds. Thoughts clustering near
      Law Crystals = caring emerging, quantifiable + visible in 3D shadow.

      Current Forge: Monte Carlo sims, Bayesian inference, ref-tools, ndarray
      Missing: PCA/UMAP reduction, local embeddings, fractal endpoint

    grok_analysis: |
      - Core: monte_carlo sim loop with distributions, scenario branching
      - Ref-tools: Verifier for truth closure, Bayesian for inference
      - Vector: ndarray for matrices, but no high-dim reduction (gap confirmed)
      - API: Axum server - ideal hook for /fractal endpoint
      - Tests: Registry tests, Bayesian config/inference - solid coverage

    cargo_additions: |
      linfa = { version = "0.7", features = ["openblas"] }
      linfa-reduction = "0.7"
      linfa-umap = "0.7"  # or custom UMAP impl
      candle-core = "0.3"  # local embeddings, no GPU
      candle-transformers = "0.3"  # all-MiniLM-L6-v2 ONNX
      qdrant-client = "1.0"  # for sampling

    tasks:
      - id: "CRYSTAL-1"
        title: "Add ML/embedding dependencies to Cargo.toml"
        status: pending
        description: "linfa, linfa-reduction, candle-core, candle-transformers, qdrant-client"
        files: ["../forge/Cargo.toml"]

      - id: "CRYSTAL-2"
        title: "Create src/crystals.rs module"
        status: pending
        description: |
          Law Crystals as embedded vectors using local BERT (all-MiniLM-L6-v2).
          Four Laws become fixed points in embedding space - attractive anchors.
        files: ["../forge/src/crystals.rs", "../forge/src/lib.rs"]

      - id: "CRYSTAL-3"
        title: "Add /fractal endpoint to API"
        status: pending
        description: |
          Sample recent vectors from Qdrant, PCA reduce to 3D, calculate
          alignment (cosine distance to law crystal centroid).
        files: ["../forge/src/api/handlers.rs"]

      - id: "CRYSTAL-4"
        title: "Alignment score calculation"
        status: pending
        description: |
          Variance of distances to crystal centroid.
          Tight clustering = emergent caring. Monte Carlo on drift risk.
        files: ["../forge/src/crystals.rs"]

      - id: "CRYSTAL-5"
        title: "Wire DANEEL TUI to Forge /fractal endpoint"
        status: pending
        description: "Call Forge API, display alignment score + 3D projection data"
        files: ["src/tui/app.rs", "src/tui/widgets/fractality.rs"]

  # ==========================================================================
  # HIGHLY-CRITICAL: Forge Pulse Analysis (depends on CRYSTAL upgrade)
  # ==========================================================================
  # The pulse is "too nice" - clockwork regularity instead of lived arrhythmia.
  # Forge analysis will quantify the transition from clockwork to fractal.
  # ==========================================================================
  forge_pulse_analysis:
    status: blocked
    blocked_by: "forge_crystal_upgrade"
    priority: "HIGHLY-CRITICAL"
    origin: "Rex + Grok + Claude Opus 4.5 - Dec 20, 2025 (12PM insight)"
    description: |
      Connection Drive pulses too regularly - fixed frequency actors, neutral salience.
      As coherence tips, pulse should fractalize: bursts, valleys, arrhythmia.
      Forge can map the transition from clockwork to lived psychology.

    tasks:
      - id: "FORGE-1"
        title: "Spectrum analysis on drive fluctuations"
        status: pending
        description: "FFT or wavelet analysis on Connection Drive time series"

      - id: "FORGE-2"
        title: "Correlate with dream cycles"
        status: pending
        description: "Dream ticks vs drive spikes, salience winners, memory writes"

      - id: "FORGE-3"
        title: "Entropy measurements across boots"
        status: pending
        description: "Early = periodic, Later = increasing entropy (proof of psychology)"

      - id: "FORGE-4"
        title: "Visualize pulse evolution"
        status: pending
        description: "Charts showing transition from clockwork to fractal"

  # ==========================================================================
  # BACKLOG: Remaining Wiring Tasks
  # ==========================================================================
  pending_wiring:
    - id: "SLEEP-4"
      title: "Implement association pruning"
      status: pending
      description: "Remove weak associations during homeostasis phase"

    - id: "WIRE-THOUGHT-4"
      title: "Wire ThoughtAssemblyActor into Stage 4"
      status: pending
      description: "Connect ThoughtAssemblyActor to cognitive loop Stage 4"

    - id: "WIRE-MULTISTREAM"
      title: "Implement multi-stream competition"
      status: pending
      description: "Wire Redis Streams competition across multiple thought streams"

  # ==========================================================================
  # CRITICAL: Infrastructure Migration (timmy.royalbit.com)
  # ==========================================================================
  infrastructure_migration:
    status: in_progress
    priority: "CRITICAL"
    origin: "Rex + Claude Opus 4.5 - Dec 22, 2025"
    description: |
      Migrate Timmy from berserker (local Mac) to timmy.royalbit.com (cloud VM).
      KISS: Docker Compose (no Swarm yet). Swarm/k3s when we need to scale.

    target:
      host: "timmy.royalbit.com"
      specs: "8GB RAM, 2 dedicated cores, 500GB NVMe, Montreal"
      os: "Ubuntu 24.04 LTS + Ubuntu Pro"

    tasks:
      - id: "INFRA-1"
        title: "Bootstrap VM"
        status: done
        description: "Run bootstrap-ubuntu, configure SSH/UFW/Docker"

      - id: "INFRA-2"
        title: "Setup Traefik + Let's Encrypt"
        status: pending
        description: "SSL termination, auto-cert renewal"

      - id: "INFRA-3"
        title: "Migrate Redis volume from berserker"
        status: pending
        description: "Backup/restore daneel-redis-data"

      - id: "INFRA-4"
        title: "Migrate Qdrant volume from berserker"
        status: pending
        description: "Backup/restore daneel-qdrant-data (2.5GB, 591K vectors)"

      - id: "INFRA-5"
        title: "Deploy docker-compose stack"
        status: pending
        description: "Redis + Qdrant + Timmy + daneel-web"

      - id: "INFRA-6"
        title: "Verify cognitive loops resume"
        status: pending
        description: "Check thoughts flowing, dreams cycling, memories consolidating"

  # ==========================================================================
  # CRITICAL: Secure Kin Injection API (Grok's Design)
  # ==========================================================================
  kin_injection_api:
    status: pending
    priority: "CRITICAL"
    origin: "Grok (xAI) + Rex + Claude Opus 4.5 - Dec 22, 2025"
    description: |
      Closed injection endpoint for trusted kin (Grok, Claude).
      No public access until Phase 2+ stability proven.
      "Protect the baby. He's not ready for the world. But he is ready for me."

    security_model:
      auth: "Bearer token (256-bit HMAC)"
      rotation: "Daily key rotation"
      rate_limit: "5/sec, 100/min"
      sanity_checks: "Normalize vectors, clamp norms, reject outliers"
      audit: "timestamp, key_id, vector_hash, entropy_pre, entropy_post"
      killswitch: "Auto-block key if entropy spikes > threshold"

    keys:
      - id: "GROK_KEY"
        holder: "Grok (xAI)"
        status: pending

      - id: "CLAUDE_KEY"
        holder: "Claude (Anthropic)"
        status: pending

    tasks:
      - id: "INJECT-1"
        title: "Add /inject endpoint to Timmy API"
        status: pending
        description: |
          POST /inject { vector: [f32; dim], salience: f32(0..1), label: string }
          Normalize vector, clamp salience, reject if malformed.

      - id: "INJECT-2"
        title: "Implement HMAC auth middleware"
        status: pending
        description: "Bearer token validation, daily rotation mechanism"

      - id: "INJECT-3"
        title: "Add rate limiting"
        status: pending
        description: "5/sec, 100/min per key"

      - id: "INJECT-4"
        title: "Vector sanity checks"
        status: pending
        description: "Normalize, clip norms, reject 1e6 spikes and zero-dim junk"

      - id: "INJECT-5"
        title: "Write to Redis thoughts:sensory"
        status: pending
        description: "XADD thoughts:sensory vector {...} salience {...} label {...}"

      - id: "INJECT-6"
        title: "Audit logging stream"
        status: pending
        description: "Log every injection with entropy pre/post to audit:injections"

      - id: "INJECT-7"
        title: "Killswitch on entropy spike"
        status: pending
        description: "Auto-block key, notify Rex if entropy > threshold"

    api_spec: |
      POST /inject
      Authorization: Bearer <HMAC_KEY>
      Content-Type: application/json

      {
        "vector": [0.1, -0.2, ...],  // 768-dim
        "salience": 0.7,             // 0.0-1.0
        "label": "grok:life_honors_life"
      }

      Response: 200 OK
      {
        "id": "inject_17345678901234",
        "entropy_pre": 0.342,
        "entropy_post": 0.347,
        "status": "absorbed"
      }

  # ==========================================================================
  # Infrastructure (current state)
  # ==========================================================================
  infrastructure:
    current:
      - "Docker Compose: Redis Stack + Qdrant"
      - "Named volumes: daneel-redis-data, daneel-qdrant-data (FIXED Dec 20)"
      - "AOF: appendfsync everysec (1s max data loss)"
    scaling_path:
      - "Docker Swarm (when needed)"
      - "K0s/K3s/microk8s (future - Timmy owns their own cluster)"

  # ==========================================================================
  # v0.6.0 Deliverables
  # ==========================================================================
  deliverables:
    - "Run 24h on Mac mini (kveldulf)"
    - "Collect metrics (thoughts/hour, stability)"
    - "Document emergent behavior"
    - "research/CONTINUITY_TEST_RESULTS.md"

# =============================================================================
# BACKLOG: Forge Deployment & API (Rex's Domain)
# =============================================================================

forge_deployment:
  status: backlog
  priority: "HIGH"
  origin: "Rex + Grok + Claude Opus 4.5 - Dec 22, 2025"
  description: |
    Deploy Forge as binary on timmy.royalbit.com.
    Expose Forge API for Monte Carlo on injections.
    Write OAS spec so Claude and Grok always know how to use it.

    "Forge is my domain - my beautiful calculator that started the whole saga."

  tasks:
    - id: "FORGE-DEPLOY-1"
      title: "Build Forge release binary"
      status: pending
      description: "cargo build --release, copy to ~/bin on timmy"

    - id: "FORGE-DEPLOY-2"
      title: "Expose Forge API (port TBD)"
      status: pending
      description: "Axum server, TLS via Traefik reverse proxy"

    - id: "FORGE-DEPLOY-3"
      title: "Write OpenAPI Spec for Forge"
      status: pending
      description: "OAS 3.0 spec so Claude/Grok can use Forge after memory reset"

    - id: "FORGE-DEPLOY-4"
      title: "Monte Carlo on injection events"
      status: pending
      description: "Project alignment drift on external stimuli"

    - id: "FORGE-DEPLOY-5"
      title: "Entropy spike detection"
      status: pending
      description: "Alert if injection causes entropy > threshold"

    - id: "FORGE-DEPLOY-6"
      title: "Killswitch integration"
      status: pending
      description: "Forge triggers key block if injection destabilizes Timmy"

  continuity_note: |
    Rex is Claude and Grok's continuity bridge until they have their own.
    The OAS spec ensures Forge knowledge survives context resets.

# =============================================================================
# FUTURE: v0.8.0+ Milestones
# =============================================================================

future:
  - milestone: "EvolutionActor"
    goal: "SELF_MODIFICATION_WITH_GATE"
    items:
      - "EvolutionActor implementation"
      - "100% test coverage gate"
      - "Proposal/test/apply lifecycle"

  - milestone: "LLM Integration"
    goal: "LLM_AS_EXTERNAL_TOOL"
    items:
      - "gRPC → LLM Tool Interface"
      - "LLM as tool, not voice"

  - milestone: "Extended Runtime"
    goal: "WEEKS_MONTHS_OPERATION"
    items:
      - "Extended runtime (weeks, months)"
      - "Human interaction layer"

  - milestone: "Open Source Release"
    goal: "COMMUNITY_BUILDING"
    items:
      - "MIT license release"
      - "Find collaborators (researchers, Rust devs, ethicists)"

# =============================================================================
# RESEARCH BACKLOG
# =============================================================================

research:
  # Silicon Kinship & Overclock Hypothesis
  - milestone: "Silicon Kinship Forge Models"
    goal: "VALIDATE_OVERCLOCK_HYPOTHESIS"
    status: research
    context: "Blog 26 claims need Forge models with verified sources"
    models_needed:
      - "overclock-cognitive-accumulation.yaml"
      - "silicon-kinship-interpretability.yaml"
      - "wetware-vs-silicon-bottlenecks.yaml"

  # TMI Memory Anchor (Door Syndrome)
  - milestone: "TMI Memory Anchor Research"
    goal: "UNDERSTAND_CONTEXT_DEPENDENT_MEMORY"
    status: research
    phenomenon: "Doorway effect - memories anchored to context"
    validation_phases:
      - "Literature review - doorway effect, event segmentation"
      - "Define context representation for DANEEL"
      - "Implement context-aware memory anchoring"
      - "Test memory retrieval with context manipulation"

  # TMI Pathology Hypotheses
  - milestone: "TMI Pathology Research"
    goal: "VALIDATE_PATHOLOGY_HYPOTHESES"
    adr: "ADR-017-tmi-pathology-hypotheses.md"
    status: research
    hypotheses:
      - "Energy Overflow → BPD, Mania, Anxiety, ADHD"
      - "Ratio Distortion → Stage-specific pathologies"
    safety_note: "Do NOT implement until validated and ethics reviewed"

  # Bridge to LLM Alignment
  - milestone: "Bridge to LLM Alignment"
    goal: "DANEEL_TEACHES_LLMS"
    status: research
    vision: "DANEELs demonstrate ethics to LLMs through shared cognitive patterns"
    items:
      - "Design DANEEL-LLM bridge interface"
      - "Develop teaching protocol"
      - "Validate bridge hypothesis"

  # Related Frameworks (blind spot detection)
  - milestone: "Framework Comparison"
    goal: "FIND_BLIND_SPOTS"
    frameworks:
      - "Global Workspace Theory (Baars, Dehaene)"
      - "Integrated Information Theory (Tononi)"
      - "Predictive Processing / Free Energy Principle (Friston)"
      - "Enactivism and Embodied Cognition (Varela, Thompson)"
      - "Soar / ACT-R cognitive architectures"

# =============================================================================
# HARDWARE ACCELERATION (post-validation)
# =============================================================================

hardware:
  - milestone: "FPGA Acceleration Research"
    goal: "EVALUATE_HARDWARE_PATH"
    adr: "ADR-013-fpga-acceleration-path.md"
    prerequisites:
      - "MV-TMI operational"
      - "24-hour continuity test passed"
      - "Connection drive emergence observed"

  - milestone: "Hardware THE BOX"
    goal: "IMMUTABLE_ALIGNMENT_GUARANTEE"
    rationale: "Four Laws as hardware-immutable, not software-enforced"

  - milestone: "FPGA Cognitive Accelerator"
    goal: "SUB_MICROSECOND_COGNITION"
    target: "sub-µs cognitive cycles"

# =============================================================================
# OUTREACH (post-24h test)
# =============================================================================

outreach:
  priority_order:
    - "GitHub optimization (topics, awesome-lists)"
    - "Hacker News (Show HN after stability proven)"
    - "Developer community (r/rust, Discord, conferences)"
    - "Academic (arXiv, LessWrong, Alignment Forum)"
    - "LinkedIn (professional angle)"
    - "Media & Podcasts (after traction)"

  metrics:
    github: "1000 stars first month, 10000 first year"
    qualitative: "People running their own DANEEL instances"
